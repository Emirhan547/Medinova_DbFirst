@model Medinova.Dtos.DoctorPatientDetailDto
@using System.Linq

@{
    ViewBag.Title = "Hasta Detayı";
    Layout = "~/Areas/Doctor/Views/Shared/_DoctorLayout.cshtml";
}

<div class="mb-8">
    <h1 class="text-2xl font-extrabold text-navy-accent">Hasta Detayı</h1>
    <p class="text-sm text-gray-500">Hasta profil bilgileri ve randevu geçmişi.</p>
</div>

<div class="grid gap-6 lg:grid-cols-3">
    <div class="bg-white rounded-xl soft-shadow p-6 border border-gray-200">
        <div class="flex items-center gap-4">
            <div class="size-20 rounded-full overflow-hidden border border-primary/20 bg-white flex items-center justify-center">
                @if (!string.IsNullOrWhiteSpace(Model.ImageUrl))
                {
                    <img src="@Model.ImageUrl" alt="@Model.FullName" class="h-full w-full object-cover" />
                }
                else
                {
                    <span class="material-symbols-outlined text-primary text-3xl">person</span>
                }
            </div>
            <div>
                <h2 class="text-lg font-bold text-navy-accent">@Model.FullName</h2>
                <p class="text-xs text-gray-400">@Model.UserName</p>
            </div>
        </div>

        <div class="mt-6 space-y-3 text-sm text-gray-600">
            <div class="flex items-center justify-between">
                <span class="text-xs font-semibold text-gray-400 uppercase">Kan Grubu</span>
                <span>@(string.IsNullOrWhiteSpace(Model.BloodType) ? "-" : Model.BloodType)</span>
            </div>
            <div class="flex items-center justify-between">
                <span class="text-xs font-semibold text-gray-400 uppercase">Boy</span>
                <span>@(Model.HeightCm.HasValue ? Model.HeightCm + " cm" : "-")</span>
            </div>
            <div class="flex items-center justify-between">
                <span class="text-xs font-semibold text-gray-400 uppercase">Kilo</span>
                <span>@(Model.WeightKg.HasValue ? Model.WeightKg + " kg" : "-")</span>
            </div>
        </div>
    </div>

    <div class="lg:col-span-2 bg-white rounded-xl soft-shadow p-6 border border-gray-200">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-bold text-navy-accent">Randevu Geçmişi</h3>
            <a class="text-xs font-semibold text-primary hover:text-primary/80" href="@Url.Action("Index", "Patients", new { area = "Doctor" })">Listeye Dön</a>
        </div>

        @if (Model.Appointments != null && Model.Appointments.Any())
        {
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200 text-sm">
                    <thead class="bg-gray-50 text-gray-500">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-semibold uppercase">Tarih</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold uppercase">Saat</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold uppercase">Durum</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
                        @foreach (var appointment in Model.Appointments)
                        {
                            var statusLabel = appointment.Status ?? "Planlandı";
                            var statusClass = statusLabel == "Cancelled" ? "text-red-600 bg-red-50" :
                                statusLabel == "Completed" ? "text-emerald-600 bg-emerald-50" :
                                "text-primary bg-primary/10";
                            <tr>
                                <td class="px-4 py-3 text-gray-600">
                                    @(appointment.AppointmentDate.HasValue ? appointment.AppointmentDate.Value.ToString("dd.MM.yyyy") : "-")
                                </td>
                                <td class="px-4 py-3 text-gray-600">
                                    @appointment.AppointmentTime
                                </td>
                                <td class="px-4 py-3">
                                    <span class="inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold @statusClass">
                                        @statusLabel
                                    </span>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
        else
        {
            <p class="text-sm text-gray-500">Bu hasta için kayıtlı randevu bulunamadı.</p>
        }
    </div>
</div>