@model Medinova.Dtos.DoctorPatientDetailDto
@using System.Linq

@{
    ViewBag.Title = "Hasta Detayı";
    Layout = "~/Areas/Doctor/Views/Shared/_DoctorLayout.cshtml";
}

<div class="max-w-7xl mx-auto">
    <!-- Page Header -->
    <div class="mb-8">
        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
            <div class="flex items-center gap-4">
                <a href="@Url.Action("Index", "Patients", new { area = "Doctor" })"
                   class="p-2 rounded-lg hover:bg-gray-100 transition-colors">
                    <span class="material-symbols-outlined text-gray-600">arrow_back</span>
                </a>
                <div>
                    <h1 class="text-2xl font-bold text-gray-900">@Model.FullName</h1>
                    <p class="text-gray-600 mt-1">Hasta profili ve randevu geçmişi</p>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <button onclick="sendMessage(@Model.PatientId)"
                        class="px-4 py-2.5 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors flex items-center gap-2">
                    <span class="material-symbols-outlined text-lg">chat</span>
                    Mesaj Gönder
                </button>
                <button onclick="scheduleAppointment(@Model.PatientId)"
                        class="px-4 py-2.5 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors flex items-center gap-2">
                    <span class="material-symbols-outlined text-lg">event_available</span>
                    Randevu Al
                </button>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Patient Profile Card -->
        <div class="lg:col-span-1">
            <div class="bg-white rounded-xl border border-gray-200 p-6">
                <div class="flex flex-col items-center text-center mb-6">
                    <div class="w-32 h-32 rounded-full border-4 border-white shadow-sm overflow-hidden mb-4">
                        @if (!string.IsNullOrWhiteSpace(Model.ImageUrl))
                        {
                            <img src="@Model.ImageUrl" alt="@Model.FullName" class="w-full h-full object-cover" />
                        }
                        else
                        {
                            <div class="flex w-full h-full items-center justify-center bg-gradient-to-br from-gray-100 to-gray-200">
                                <span class="material-symbols-outlined text-gray-600 text-4xl">person</span>
                            </div>
                        }
                    </div>
                    <h2 class="text-xl font-bold text-gray-900">@Model.FullName</h2>
                    <p class="text-gray-500 text-sm mt-1">@Model.UserName</p>
                    <div class="mt-3">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 border border-blue-200">
                            <span class="material-symbols-outlined text-xs mr-1">verified</span>
                            Aktif Hasta
                        </span>
                    </div>
                </div>

                <!-- Patient Info -->
                <div class="space-y-4">
                    <div class="flex items-center justify-between py-3 border-b border-gray-100">
                        <span class="text-sm font-medium text-gray-500">Hasta No</span>
                        <span class="text-sm font-medium text-gray-900">#@Model.PatientId</span>
                    </div>

                    <div class="flex items-center justify-between py-3 border-b border-gray-100">
                        <span class="text-sm font-medium text-gray-500">Kan Grubu</span>
                        <span class="text-sm font-medium text-gray-900">
                            @if (!string.IsNullOrWhiteSpace(Model.BloodType))
                            {
                                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium @(Model.BloodType.Contains("+") ? "bg-red-100 text-red-800" : "bg-blue-100 text-blue-800")">
                                    @Model.BloodType
                                </span>
                            }
                            else
                            {
                                <span class="text-gray-400">-</span>
                            }
                        </span>
                    </div>

                    <div class="flex items-center justify-between py-3 border-b border-gray-100">
                        <span class="text-sm font-medium text-gray-500">Boy</span>
                        <span class="text-sm font-medium text-gray-900">
                            @if (Model.HeightCm.HasValue)
                            {
                                @Model.HeightCm 
                                            }
                            else
                            {
                                <span class="text-gray-400">-</span>
                            }
                        </span>
                    </div>

                    <div class="flex items-center justify-between py-3 border-b border-gray-100">
                        <span class="text-sm font-medium text-gray-500">Kilo</span>
                        <span class="text-sm font-medium text-gray-900">
                            @if (Model.WeightKg.HasValue)
                            {
                                @Model.WeightKg 
                                            }
                            else
                            {
                                <span class="text-gray-400">-</span>
                            }
                        </span>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="mt-6 pt-6 border-t border-gray-200">
                    <h3 class="text-sm font-medium text-gray-900 mb-3">Hızlı İşlemler</h3>
                    <div class="grid grid-cols-2 gap-3">
                        <button class="p-3 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors flex flex-col items-center">
                            <span class="material-symbols-outlined text-blue-600 mb-1 text-lg">description</span>
                            <span class="text-xs font-medium text-gray-700">Reçete</span>
                        </button>
                        <button class="p-3 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors flex flex-col items-center">
                            <span class="material-symbols-outlined text-blue-600 mb-1 text-lg">lab_profile</span>
                            <span class="text-xs font-medium text-gray-700">Rapor</span>
                        </button>
                        <button class="p-3 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors flex flex-col items-center">
                            <span class="material-symbols-outlined text-blue-600 mb-1 text-lg">video_call</span>
                            <span class="text-xs font-medium text-gray-700">Görüşme</span>
                        </button>
                        <button class="p-3 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors flex flex-col items-center">
                            <span class="material-symbols-outlined text-blue-600 mb-1 text-lg">note_add</span>
                            <span class="text-xs font-medium text-gray-700">Not</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Appointments History -->
        <div class="lg:col-span-2">
            <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h2 class="text-lg font-semibold text-gray-900">Randevu Geçmişi</h2>
                        <span class="text-sm text-gray-500">
                            @(Model.Appointments?.Count() ?? 0) randevu
                        </span>
                    </div>
                </div>

                @if (Model.Appointments != null && Model.Appointments.Any())
                {
                    <div class="divide-y divide-gray-100">
                        @foreach (var appointment in Model.Appointments)
                        {
                            var statusClass = appointment.Status switch
                            {
                                "Completed" => "bg-blue-100 text-blue-800",
                                "Cancelled" => "bg-red-100 text-red-800",
                                "Active" => "bg-blue-100 text-blue-800",
                                _ => "bg-gray-100 text-gray-800"
                            };

                            <div class="px-6 py-4 hover:bg-gray-50/50 transition-colors">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="font-medium text-gray-900">
                                            @(appointment.AppointmentDate?.ToString("dd MMMM yyyy")) - @appointment.AppointmentTime
                                        </p>
                                    </div>
                                    <div class="flex items-center gap-3">
                                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium @statusClass">
                                            @appointment.Status
                                        </span>
                                        <button onclick="showAppointmentDetails(@appointment.AppointmentId)"
                                                class="text-sm text-blue-600 hover:text-blue-700 hover:bg-blue-50 px-3 py-1 rounded-lg transition-colors">
                                            Detay
                                        </button>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                }
                else
                {
                    <div class="px-6 py-12 text-center">
                        <div class="mx-auto w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4">
                            <span class="material-symbols-outlined text-gray-400 text-2xl">event</span>
                        </div>
                        <h3 class="text-lg font-medium text-gray-900 mb-2">Randevu geçmişi bulunmuyor</h3>
                        <p class="text-gray-500 mb-6">Bu hasta için henüz randevu kaydı oluşturulmamış.</p>
                        <button onclick="scheduleAppointment(@Model.PatientId)"
                                class="px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors">
                            İlk Randevuyu Oluştur
                        </button>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<script>
    function sendMessage(patientId) {
        alert('Mesaj gönderim ekranı açılıyor (Hasta ID: ' + patientId + ')');
    }

    function scheduleAppointment(patientId) {
        alert('Randevu oluşturma ekranı açılıyor (Hasta ID: ' + patientId + ')');
    }

    function showAppointmentDetails(appointmentId) {
        alert('Randevu detayları (ID: ' + appointmentId + ')');
    }
</script>