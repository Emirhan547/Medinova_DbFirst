@model Medinova.Models.About
@{
    ViewBag.Title = "UpdateAbout";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="space-y-6">
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-2xl font-bold text-slate-900 dark:text-white">Hakkımızda Bölümünü Düzenle</h1>
            <p class="text-slate-500 dark:text-slate-400 mt-1">Hakkımızda bölümü içeriğini güncelleyin</p>
        </div>
        <a href="@Url.Action("Index", "About", new { area = "Admin" })"
           class="text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white flex items-center gap-2 text-sm font-medium">
            <span class="material-symbols-outlined !text-lg">arrow_back</span>
            Listeye Dön
        </a>
    </div>

    <div class="bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 p-6">
        <form method="post" action="@Url.Action("UpdateAbout", "About", new { area = "Admin", id = Model.AboutId })" enctype="multipart/form-data" class="space-y-6">
            @Html.AntiForgeryToken()
            @Html.HiddenFor(m => m.AboutId)

            <div class="grid grid-cols-1 gap-6">
                <!-- Başlık -->
                <div>
                    <label for="Title" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                        Başlık <span class="text-red-500">*</span>
                    </label>
                    <input type="text" id="Title" name="Title" value="@Model.Title"
                           class="w-full bg-slate-50 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg px-4 py-2.5 text-sm focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-all"
                           placeholder="Hakkımızda başlığını girin"
                           required>
                </div>

                <!-- Açıklama -->
                <div>
                    <label for="Description" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                        Açıklama <span class="text-red-500">*</span>
                    </label>
                    <textarea id="Description" name="Description" rows="6"
                              class="w-full bg-slate-50 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg px-4 py-2.5 text-sm focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-all resize-none"
                              placeholder="Hakkımızda açıklamasını girin"
                              required>@Model.Description</textarea>
                </div>

                <!-- Mevcut Resim -->
                @if (!string.IsNullOrEmpty(Model.ImageUrl))
                {
                    <div>
                        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                            Mevcut Resim
                        </label>
                        <div class="flex items-center gap-4">
                            <div class="size-32 rounded-lg bg-cover bg-center border-2 border-slate-200 dark:border-slate-600"
                                 style="background-image: url('@Model.ImageUrl')"></div>
                            <div>
                                <p class="text-sm text-slate-600 dark:text-slate-400">Mevcut resim görüntüleniyor</p>
                                <button type="button" onclick="clearImageUrl()"
                                        class="mt-2 text-sm text-red-500 hover:text-red-600 flex items-center gap-1">
                                    <span class="material-symbols-outlined !text-base">delete</span>
                                    Resmi Kaldır
                                </button>
                            </div>
                        </div>
                    </div>
                }

                <!-- Resim Yükleme -->
                <div>
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                        Resmi Değiştir <span class="text-slate-400 text-xs">(Opsiyonel)</span>
                    </label>

                    <!-- Yeni Resim Önizleme -->
                    <div id="imagePreview" class="mb-4 hidden">
                        <div class="relative inline-block">
                            <div class="size-40 rounded-lg bg-cover bg-center border-2 border-slate-200 dark:border-slate-600"
                                 id="previewImage"></div>
                            <button type="button" onclick="removeNewImage()"
                                    class="absolute -top-2 -right-2 size-8 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 transition-colors">
                                <span class="material-symbols-outlined !text-lg">close</span>
                            </button>
                        </div>
                    </div>

                    <!-- Dosya Yükleme -->
                    <div class="border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg p-6 text-center hover:border-primary/50 transition-colors cursor-pointer"
                         onclick="document.getElementById('fileInput').click()"
                         id="uploadArea">
                        <span class="material-symbols-outlined !text-4xl text-slate-400 dark:text-slate-500 mb-2">cloud_upload</span>
                        <p class="text-sm text-slate-600 dark:text-slate-400 mb-1">
                            <span class="font-medium text-primary hover:text-primary/80 cursor-pointer">Yüklemek için tıklayın</span> veya sürükleyip bırakın
                        </p>
                        <p class="text-xs text-slate-500 dark:text-slate-500">PNG, JPG veya GIF (MAX. 5MB)</p>
                        <input type="file" id="fileInput" name="ImageFile" accept="image/*"
                               class="hidden" onchange="previewImage(event)">
                    </div>

                    <!-- Veya URL Girişi -->
                    <div class="mt-4">
                        <p class="text-sm text-slate-500 dark:text-slate-400 mb-2 text-center">Veya yeni resim URL'si girin</p>
                        <input type="url" id="ImageUrl" name="ImageUrl" value="@Model.ImageUrl"
                               class="w-full bg-slate-50 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg px-4 py-2.5 text-sm focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-all"
                               placeholder="https://example.com/image.jpg">
                    </div>
                </div>
            </div>

            <!-- Form İşlemleri -->
            <div class="flex items-center justify-between pt-6 border-t border-slate-200 dark:border-slate-700">
                <a href="@Url.Action("Index", "About", new { area = "Admin" })"
                   class="px-5 py-2.5 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg text-sm font-medium hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors">
                    İptal
                </a>
                <div class="flex items-center gap-3">
                    <button type="submit"
                            class="bg-primary hover:bg-primary/90 text-white px-6 py-2.5 rounded-lg text-sm font-semibold flex items-center gap-2 transition-colors">
                        <span class="material-symbols-outlined !text-lg">save</span>
                        Hakkımızda Bölümünü Güncelle
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
    function previewImage(event) {
        const file = event.target.files[0];
        const preview = document.getElementById('previewImage');
        const imagePreview = document.getElementById('imagePreview');
        const uploadArea = document.getElementById('uploadArea');

        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                preview.style.backgroundImage = `url('${e.target.result}')`;
                imagePreview.classList.remove('hidden');
                uploadArea.classList.add('hidden');
            }
            reader.readAsDataURL(file);
        }
    }

    function removeNewImage() {
        const fileInput = document.getElementById('fileInput');
        const imagePreview = document.getElementById('imagePreview');
        const uploadArea = document.getElementById('uploadArea');

        fileInput.value = '';
        imagePreview.classList.add('hidden');
        uploadArea.classList.remove('hidden');
    }

    function clearImageUrl() {
        document.getElementById('ImageUrl').value = '';
        alert('Resim URL\'si temizlendi. Değişiklikleri kaydederek resmi kaldırın.');
    }

    // Sürükle bırak işlevselliği
    const uploadArea = document.getElementById('uploadArea');

    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('border-primary', 'bg-primary/5');
    });

    uploadArea.addEventListener('dragleave', () => {
        uploadArea.classList.remove('border-primary', 'bg-primary/5');
    });

    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('border-primary', 'bg-primary/5');

        const file = e.dataTransfer.files[0];
        if (file && file.type.startsWith('image/')) {
            const fileInput = document.getElementById('fileInput');
            const dataTransfer = new DataTransfer();
            dataTransfer.items.add(file);
            fileInput.files = dataTransfer.files;

            // Önizlemeyi tetikle
            const event = new Event('change');
            fileInput.dispatchEvent(event);
        }
    });
</script>